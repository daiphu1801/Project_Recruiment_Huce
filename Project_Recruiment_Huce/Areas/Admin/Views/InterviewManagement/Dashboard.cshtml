@model Project_Recruiment_Huce.Areas.Admin.Models.InterviewDashboardViewModel
@{
    ViewBag.Title = "Thống kê lịch phỏng vấn";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@Html.Partial("~/Areas/Admin/Views/Shared/_Breadcrumbs.cshtml")

<div class="app-content">
    <div class="container-fluid">
        <!-- Statistics Cards -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <div class="small-box text-bg-primary">
                    <div class="inner">
                        <h3>@Model.TodayInterviews</h3>
                        <p>Lịch PV hôm nay</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M12.75 12.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM7.5 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM8.25 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM9.75 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM10.5 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM12.75 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM14.25 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM15 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM16.5 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM15 12.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM16.5 13.5a.75.75 0 100-1.5.75.75 0 000 1.5z"></path>
                        <path fill-rule="evenodd" d="M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z" clip-rule="evenodd"></path>
                    </svg>
                    <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin" })" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                        Xem chi tiết <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box text-bg-success">
                    <div class="inner">
                        <h3>@Model.WeekInterviews</h3>
                        <p>Lịch PV tuần này</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path clip-rule="evenodd" fill-rule="evenodd" d="M2.25 13.5a8.25 8.25 0 018.25-8.25.75.75 0 01.75.75v6.75H18a.75.75 0 01.75.75 8.25 8.25 0 01-16.5 0z"></path>
                        <path clip-rule="evenodd" fill-rule="evenodd" d="M12.75 3a.75.75 0 01.75-.75 8.25 8.25 0 018.25 8.25.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75V3z"></path>
                    </svg>
                    <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin" })" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                        Xem chi tiết <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box text-bg-warning">
                    <div class="inner">
                        <h3>@Model.MonthInterviews</h3>
                        <p>Lịch PV tháng này</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"></path>
                    </svg>
                    <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin" })" class="small-box-footer link-dark link-underline-opacity-0 link-underline-opacity-50-hover">
                        Xem chi tiết <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box text-bg-info">
                    <div class="inner">
                        <h3>@Model.AttendanceRate.ToString("0.0")%</h3>
                        <p>Tỷ lệ tham dự</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M18.75 12.75h1.5a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5zM12 6a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 6zM12 18a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 18zM3.75 6.75h1.5a.75.75 0 100-1.5h-1.5a.75.75 0 000 1.5zM5.25 18.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 010 1.5zM3 12a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 013 12zM9 3.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zM12.75 12a2.25 2.25 0 114.5 0 2.25 2.25 0 01-4.5 0zM9 15.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z"></path>
                    </svg>
                    <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin" })" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                        Xem chi tiết <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Status Overview -->
        <div class="row">
            <div class="col-lg-4 col-6">
                <div class="small-box bg-gradient-warning">
                    <div class="inner">
                        <h3>@Model.PendingInterviews</h3>
                        <p>Chờ phỏng vấn</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>
            <div class="col-lg-4 col-6">
                <div class="small-box bg-gradient-success">
                    <div class="inner">
                        <h3>@Model.CompletedInterviews</h3>
                        <p>Đã hoàn thành</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>
            <div class="col-lg-4 col-6">
                <div class="small-box bg-gradient-danger">
                    <div class="inner">
                        <h3>@Model.CancelledInterviews</h3>
                        <p>Đã hủy</p>
                    </div>
                    <svg class="small-box-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Charts and Top Recruiters -->
        <div class="row">
            <!-- Interview Trend Chart -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="bi bi-graph-up me-2"></i>
                            Xu hướng lịch phỏng vấn
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-lte-toggle="card-collapse">
                                <i data-lte-icon="expand" class="bi bi-plus-lg"></i>
                                <i data-lte-icon="collapse" class="bi bi-dash-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="interviewTrendChart" style="height: 300px"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top Recruiters -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="bi bi-trophy me-2"></i>
                            Top nhà tuyển dụng
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-lte-toggle="card-collapse">
                                <i data-lte-icon="expand" class="bi bi-plus-lg"></i>
                                <i data-lte-icon="collapse" class="bi bi-dash-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush">
                            @if (Model.TopRecruiters != null && Model.TopRecruiters.Any())
                            {
                                foreach (var recruiter in Model.TopRecruiters.Take(5))
                                {
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            <div class="fw-bold">@recruiter.RecruiterName</div>
                                            <small class="text-muted">@recruiter.RecruiterEmail</small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge text-bg-primary rounded-pill">@recruiter.InterviewCount PV</span>
                                            <br />
                                            <small class="text-success">@recruiter.AttendanceRate.ToString("0.0")%</small>
                                        </div>
                                    </li>
                                }
                            }
                            else
                            {
                                <li class="list-group-item text-center text-muted py-4">
                                    Chưa có dữ liệu
                                </li>
                            }
                        </ul>
                    </div>
                    <div class="card-footer text-center">
                        <a href="@Url.Action("Index", "Recruiters", new { area = "Admin" })" class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">
                            Xem tất cả nhà tuyển dụng
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="bi bi-lightning me-2"></i>
                            Thao tác nhanh
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin" })" class="btn btn-outline-primary btn-lg w-100 mb-3">
                                    <i class="bi bi-list-ul d-block mb-2" style="font-size: 2rem;"></i>
                                    Danh sách lịch PV
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="@Url.Action("Index", "InterviewManagement", new { area = "Admin", status = "Pending" })" class="btn btn-outline-warning btn-lg w-100 mb-3">
                                    <i class="bi bi-clock-history d-block mb-2" style="font-size: 2rem;"></i>
                                    Lịch chờ phỏng vấn
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="@Url.Action("Index", "Applications", new { area = "Admin" })" class="btn btn-outline-success btn-lg w-100 mb-3">
                                    <i class="bi bi-file-earmark-text d-block mb-2" style="font-size: 2rem;"></i>
                                    Hồ sơ ứng tuyển
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="@Url.Action("Index", "Recruiters", new { area = "Admin" })" class="btn btn-outline-info btn-lg w-100 mb-3">
                                    <i class="bi bi-people d-block mb-2" style="font-size: 2rem;"></i>
                                    Nhà tuyển dụng
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Interview Trend Chart
        var ctx = document.getElementById('interviewTrendChart').getContext('2d');
        var trendData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.TrendData));
        
        var labels = trendData.map(d => d.Label);
        var values = trendData.map(d => d.Value);

        var interviewTrendChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Số lượng lịch PV',
                    data: values,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    },
                    title: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    </script>
}
