@using System.Web
@{
    // Use ViewBag or route values. Expect ViewBag.CurrentPage, ViewBag.TotalPages, ViewBag.TotalItems, optional ViewBag.PageSize
    var currentPage = (int?)(ViewBag.CurrentPage) ?? 1;
    var totalPages = (int?)(ViewBag.TotalPages) ?? 0;
    var totalItems = (int?)(ViewBag.TotalItems) ?? 0;
    var pageSize = (int?)(ViewBag.PageSize) ?? 10;

    Func<int, string> makeUrl = page => {
        var raw = Request.QueryString.ToString() ?? string.Empty;
        var qs = HttpUtility.ParseQueryString(raw);
        qs["page"] = page.ToString();
        var action = ViewContext.RouteData.Values["action"]?.ToString() ?? "Index";
        var controller = ViewContext.RouteData.Values["controller"]?.ToString();
        var url = Url.Action(action, controller, new { area = "Admin" });
        var q = qs.ToString();
        return string.IsNullOrEmpty(q) ? url : url + "?" + q;
    };
}

@if (totalPages > 1)
{
    <div class="admin-pagination-wrap">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="text-sm text-muted">Hiển thị @((currentPage - 1) * pageSize + 1)-@Math.Min(currentPage * pageSize, totalItems) trong tổng số @totalItems mục</div>
            <div>
                <nav aria-label="Admin pagination">
                    <ul class="pagination mb-0">
                        @if (currentPage > 1)
                        {
                            <li class="page-item"><a class="page-link" href="@makeUrl(currentPage - 1)">« Trước</a></li>
                        }
                        else
                        {
                            <li class="page-item disabled"><span class="page-link">« Trước</span></li>
                        }

                        @for (int i = 1; i <= totalPages; i++)
                        {
                            if (i == 1 || i == totalPages || (i >= currentPage - 2 && i <= currentPage + 2))
                            {
                                if (i == currentPage)
                                {
                                    <li class="page-item active" aria-current="page"><span class="page-link">@i</span></li>
                                }
                                else
                                {
                                    <li class="page-item"><a class="page-link" href="@makeUrl(i)">@i</a></li>
                                }
                            }
                            else if (i == currentPage - 3 || i == currentPage + 3)
                            {
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                            }
                        }

                        @if (currentPage < totalPages)
                        {
                            <li class="page-item"><a class="page-link" href="@makeUrl(currentPage + 1)">Sau »</a></li>
                        }
                        else
                        {
                            <li class="page-item disabled"><span class="page-link">Sau »</span></li>
                        }
                    </ul>
                </nav>
            </div>
        </div>
    </div>
}



