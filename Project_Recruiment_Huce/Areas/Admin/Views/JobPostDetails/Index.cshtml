@model List<Project_Recruiment_Huce.Areas.Admin.Models.JobPostDetailVm>
@using Project_Recruiment_Huce.Areas.Admin.Models
@{
    ViewBag.AddUrl = Url.Action("edit ");
    ViewBag.AddLabel = "Sửa thông tin ";
}


@{
    ViewBag.Title = "Quản lý Chi tiết Yêu cầu";

    // Giả định JobPostID được truyền qua ViewBag nếu bạn đang lọc theo một JobPost cụ thể
    // string jobTitle = ViewBag.JobTitle ?? "Tất cả";
    // int? jobId = ViewBag.JobPostID;

    // Nếu Model có dữ liệu, lấy thông tin tiêu đề/ID từ bản ghi đầu tiên
    string jobTitle = Model != null && Model.Any() ? Model.First().Title : "Tất cả";
    int? jobId = Model != null && Model.Any() ? Model.First().JobPostID : (int?)null;
}

@Html.Partial("~/Areas/Admin/Views/Shared/_Breadcrumbs.cshtml")

<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0">
            <i class="bi bi-list-columns-reverse"></i> Chi tiết Yêu cầu:
            <strong>@(jobTitle)</strong>
        </h5>
    </div>

    <div class="card-body">
        @if (jobId.HasValue)
        {
            <div class="mb-3">
                <a href="@Url.Action("Index", "JobPosts")" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Quay lại Tin tuyển dụng
                </a>
                @* Nếu mỗi JobPost chỉ có 1 Detail, ta không cần nút Create ở đây *@
            </div>
        }

        <div class="table-responsive p-0">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th style="width:15%">Ngành / Chuyên môn</th>
                        <th style="width:10%">K.nghiệm</th>
                        <th style="width:15%">Bằng cấp</th>
                        <th style="width:20%">Kỹ năng (Tags)</th>
                        <th style="width:8%">Số lượng</th>
                        <th style="width:8%">Giới tính</th>
                        <th style="width:10%">Độ tuổi</th>
                        <th style="width:7%">Trạng thái</th>
                        <th style="width:7%">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    <strong class="text-primary">@item.Industry</strong><br />
                                    <small class="text-muted">@item.Major</small>
                                </td>
                                <td>@item.YearsExperience năm</td>
                                <td>@(item.DegreeRequired ?? "-")</td>
                                <td>
                                    <span class="small text-wrap">@(item.Skills?.Length > 50 ? item.Skills.Substring(0, 50) + "..." : item.Skills ?? "-")</span>
                                </td>
                                <td>@item.Headcount</td>
                                <td>@item.GenderRequirement</td>

                                @* Định dạng Độ tuổi *@
                                <td>
                                    @{
                                        string ageRange = "-";
                                        if (item.AgeFrom.HasValue && item.AgeTo.HasValue)
                                        {
                                            ageRange = $"{item.AgeFrom.Value} - {item.AgeTo.Value}";
                                        }
                                        else if (item.AgeFrom.HasValue)
                                        {
                                            ageRange = $"Từ {item.AgeFrom.Value}";
                                        }
                                        else if (item.AgeTo.HasValue)
                                        {
                                            ageRange = $"Đến {item.AgeTo.Value}";
                                        }
                                    }
                                    @ageRange
                                </td>

                                <td>@Html.Partial("~/Areas/Admin/Views/Shared/_StatusBadge.cshtml", System.Tuple.Create(item.Status, "JobPostDetails"))</td>
                                <td>
                                    <a href="@Url.Action("Edit", new { id = item.DetailID })" class="btn btn-sm btn-warning" title="Chỉnh sửa">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="9" class="text-center text-muted py-4">
                                <i class="bi bi-info-circle"></i> Không có dữ liệu chi tiết yêu cầu nào được tìm thấy.
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>