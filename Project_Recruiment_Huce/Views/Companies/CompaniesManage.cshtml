@model Project_Recruiment_Huce.Models.Companies.CompanyManageViewModel
@{
    ViewBag.Title = "Quản lý công ty";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <h1 class="text-white font-weight-bold">Quản lý công ty</h1>
                <div class="custom-breadcrumbs">
                    <a href="@Url.Action("Index","Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
                    <span class="text-white"><strong>Công ty</strong></span>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="site-section">
    <div class="container">
        <div class="row mb-5">
            <div class="col-lg-12">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        @TempData["SuccessMessage"]
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                }

                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        @TempData["ErrorMessage"]
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                }

                @using (Html.BeginForm("CompaniesManage", "Companies", FormMethod.Post, new { @class = "p-4 p-md-5 border rounded", id = "company-form", enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(m => m.CompanyID)

                    <h3 class="text-black mb-5 border-bottom pb-2">Thông tin công ty</h3>

                    <!-- Logo Upload Section -->
                    <div class="form-group">
                        <label for="Logo">Logo công ty</label>
                        @if (!string.IsNullOrEmpty(Model?.LogoUrl))
                        {
                            <div class="mb-3">
                                <img src="@Url.Content("~" + Model.LogoUrl)" alt="Logo công ty" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd; border-radius: 4px; padding: 5px;" />
                                <p class="text-muted small mt-2">Logo hiện tại</p>
                            </div>
                        }
                        <input type="file" name="Logo" id="Logo" accept="image/*" class="form-control-file" />
                        <small class="form-text text-muted">Chỉ chấp nhận file ảnh (jpg, jpeg, png, gif, webp), tối đa 5MB</small>
                        @Html.ValidationMessageFor(m => m.Logo, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-group">
                        <label for="CompanyName">Tên công ty <span class="text-danger">*</span></label>
                        @Html.TextBoxFor(m => m.CompanyName, new { @class = "form-control", placeholder = "Ví dụ: Công ty TNHH ABC" })
                        @Html.ValidationMessageFor(m => m.CompanyName, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="TaxCode">Mã số thuế</label>
                            @Html.TextBoxFor(m => m.TaxCode, new { @class = "form-control", placeholder = "0123456789" })
                            @Html.ValidationMessageFor(m => m.TaxCode, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-6">
                            <label for="Industry">Lĩnh vực hoạt động</label>
                            @Html.TextBoxFor(m => m.Industry, new { @class = "form-control", placeholder = "Ví dụ: Công nghệ thông tin" })
                            @Html.ValidationMessageFor(m => m.Industry, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Address">Địa chỉ</label>
                        @Html.TextBoxFor(m => m.Address, new { @class = "form-control", placeholder = "Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành phố" })
                        @Html.ValidationMessageFor(m => m.Address, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="Phone">Số điện thoại</label>
                            @Html.TextBoxFor(m => m.Phone, new { @class = "form-control", placeholder = "090..." })
                            @Html.ValidationMessageFor(m => m.Phone, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-4">
                            <label for="Fax">Số fax</label>
                            @Html.TextBoxFor(m => m.Fax, new { @class = "form-control", placeholder = "024..." })
                            @Html.ValidationMessageFor(m => m.Fax, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-4">
                            <label for="CompanyEmail">Email công ty</label>
                            @Html.TextBoxFor(m => m.CompanyEmail, new { @class = "form-control", type = "email", placeholder = "contact@company.com" })
                            @Html.ValidationMessageFor(m => m.CompanyEmail, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Website">Website</label>
                        @Html.TextBoxFor(m => m.Website, new { @class = "form-control", placeholder = "https://www.company.com" })
                        @Html.ValidationMessageFor(m => m.Website, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-group">
                        <label for="Description">Mô tả công ty</label>
                        @Html.HiddenFor(m => m.Description, new { id = "hiddenDescription" })

                        <div id="editor-container" style="height: 300px; background-color: #fff;"></div>

                        @Html.ValidationMessageFor(m => m.Description, "", new { @class = "text-danger" })
                        <small class="form-text text-muted">Bạn có thể sử dụng các công cụ định dạng để tạo mô tả đẹp mắt</small>
                    </div>

                    <div class="text-right">
                        <button type="submit" class="btn btn-primary btn-md">Lưu thông tin công ty</button>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

@section Scripts {
    <script>
        $(document).ready(function() {
            var quill = new Quill('#editor-container', {
                theme: 'snow',
                placeholder: 'Mô tả về công ty, văn hóa, môi trường làm việc...',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['blockquote', 'code-block'],
                        ['link'],
                        ['clean']
                    ]
                }
            });

            var initialContent = @Html.Raw(Json.Encode(Model.Description));
            if (initialContent) {
                quill.clipboard.dangerouslyPasteHTML(initialContent);
            }

            $('#company-form').on('submit', function(e) {
                var htmlContent = quill.root.innerHTML;

                $('#hiddenDescription').val(htmlContent);

                console.log("Dữ liệu gửi đi:", htmlContent);
            });
        });
    </script>
}
