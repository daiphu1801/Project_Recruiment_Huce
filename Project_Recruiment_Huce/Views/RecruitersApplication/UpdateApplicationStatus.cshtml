@model Project_Recruiment_Huce.Models.Recruiters.UpdateApplicationStatusViewModel

@{
    ViewBag.Title = "Cập nhật trạng thái đơn ứng tuyển";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <h1 class="text-white font-weight-bold">Cập nhật trạng thái đơn ứng tuyển</h1>
                <div class="custom-breadcrumbs">
                    <a href="@Url.Action("Index","Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
                    <a href="@Url.Action("MyApplications","RecruitersApplication")">Đơn ứng tuyển</a> <span class="mx-2 slash">/</span>
                    <a href="@Url.Action("ApplicationDetails","RecruitersApplication", new { id = Model.ApplicationID })">Chi tiết</a> <span class="mx-2 slash">/</span>
                    <span class="text-white"><strong>Cập nhật trạng thái</strong></span>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="site-section">
    <div class="container">
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["ErrorMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="icon-edit mr-2"></i>Cập nhật trạng thái</h4>
                    </div>
                    <div class="card-body">
                        <!-- Application Info -->
                        <div class="alert alert-info">
                            <strong>Ứng viên:</strong> @Model.CandidateName<br>
                            <strong>Công việc:</strong> @Model.JobTitle
                        </div>

                        @using (Html.BeginForm("UpdateApplicationStatus", "RecruitersApplication", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(m => m.ApplicationID)
                            @Html.HiddenFor(m => m.JobPostID)

                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <div class="form-group">
                                @Html.LabelFor(m => m.Status, new { @class = "form-label font-weight-bold" })
                                @Html.DropDownListFor(m => m.Status, ViewBag.StatusOptions as SelectList, "-- Chọn trạng thái --", new { @class = "form-control form-control-lg" })
                                @Html.ValidationMessageFor(m => m.Status, "", new { @class = "text-danger" })
                                <small class="form-text text-muted">
                                    <strong>Trạng thái hiện tại:</strong> 
                                    <span id="currentStatus">@Model.Status</span>
                                </small>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(m => m.Note, new { @class = "form-label font-weight-bold" })
                                @Html.TextAreaFor(m => m.Note, new { @class = "form-control", rows = "5", placeholder = "Nhập ghi chú về trạng thái này (tùy chọn)..." })
                                @Html.ValidationMessageFor(m => m.Note, "", new { @class = "text-danger" })
                                <small class="form-text text-muted">
                                    Ghi chú này sẽ được lưu cùng với đơn ứng tuyển và có thể xem lại sau.
                                </small>
                            </div>

                            <div class="form-group mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="icon-check mr-2"></i>Cập nhật trạng thái
                                </button>
                                <a href="@Url.Action("ApplicationDetails", "RecruitersApplication", new { id = Model.ApplicationID })" class="btn btn-secondary btn-lg">
                                    <i class="icon-arrow-left mr-2"></i>Hủy
                                </a>
                            </div>
                        }
                    </div>
                </div>

                <!-- Status Guide -->
                <div class="card mt-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="icon-info mr-2"></i>Hướng dẫn trạng thái</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-3">
                                <span class="badge badge-warning mr-2">Đang xem xét</span>
                                <span>Ứng viên đã nộp đơn, đang chờ xem xét hồ sơ</span>
                            </li>
                            <li class="mb-3">
                                <span class="badge badge-info mr-2">Phỏng vấn</span>
                                <span>Đã lên lịch hoặc đang trong quá trình phỏng vấn</span>
                            </li>
                            <li class="mb-3">
                                <span class="badge badge-primary mr-2">Đã đề xuất</span>
                                <span>Đã đề xuất offer cho ứng viên</span>
                            </li>
                            <li class="mb-3">
                                <span class="badge badge-success mr-2">Đã tuyển</span>
                                <span>Ứng viên đã được tuyển dụng</span>
                            </li>
                            <li class="mb-3">
                                <span class="badge badge-danger mr-2">Đã từ chối</span>
                                <span>Đã từ chối ứng viên này</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="icon-list mr-2"></i>Thông tin đơn ứng tuyển</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Mã đơn:</strong> #@Model.ApplicationID</p>
                        <p><strong>Ứng viên:</strong> @Model.CandidateName</p>
                        <p><strong>Công việc:</strong> @Model.JobTitle</p>
                        <hr>
                        <a href="@Url.Action("ApplicationDetails", "RecruitersApplication", new { id = Model.ApplicationID })" class="btn btn-outline-primary btn-block">
                            <i class="icon-eye mr-2"></i>Xem chi tiết đơn
                        </a>
                        <a href="@Url.Action("MyApplications", "RecruitersApplication")" class="btn btn-outline-secondary btn-block mt-2">
                            <i class="icon-arrow-left mr-2"></i>Quay lại danh sách
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Update current status display based on selected value
            $('#Status').on('change', function() {
                var selectedText = $(this).find('option:selected').text();
                $('#currentStatus').text(selectedText);
            });
        });
    </script>
}

