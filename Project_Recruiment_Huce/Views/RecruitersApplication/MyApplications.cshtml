@model IEnumerable<Project_Recruiment_Huce.Models.Recruiters.RecruiterApplicationViewModel>

@{
    ViewBag.Title = "Đơn ứng tuyển";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <h1 class="text-white font-weight-bold">Đơn ứng tuyển</h1>
                <div class="custom-breadcrumbs">
                    <a href="@Url.Action("Index","Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
                    <a href="@Url.Action("RecruitersManage","Recruiters")">Hồ sơ của tôi</a> <span class="mx-2 slash">/</span>
                    <span class="text-white"><strong>Đơn ứng tuyển</strong></span>
                </div>
                @if (ViewBag.TotalItems != null)
                {
                    <div class="mt-3">
                        <span class="text-white" style="font-size: 1rem; opacity: 0.9;">
                            <i class="icon-file-text mr-2"></i>Tổng cộng: @ViewBag.TotalItems đơn ứng tuyển
                            @if (ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
                            {
                                <span class="ml-3">
                                    <i class="icon-layer mr-2"></i>Trang @ViewBag.CurrentPage / @ViewBag.TotalPages
                                </span>
                            }
                        </span>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<section class="site-section">
    <div class="container">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["ErrorMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        <!-- Filter Section -->
        <div class="card mb-4 border-0 shadow-sm">
            <div class="card-header bg-gradient-primary text-white border-0">
                <h5 class="mb-0"><i class="icon-filter mr-2"></i>Bộ lọc đơn ứng tuyển</h5>
            </div>
            <div class="card-body p-4">
                @using (Html.BeginForm("MyApplications", "RecruitersApplication", FormMethod.Get, new { @class = "filter-form" }))
                {
                    <div class="row align-items-end">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <label for="jobId" class="form-label font-weight-bold text-dark">
                                <i class="icon-briefcase mr-1 text-primary"></i>Công việc
                            </label>
                            @Html.DropDownList("jobId", ViewBag.Jobs as SelectList, "-- Tất cả công việc --", new { @class = "form-control form-control-lg custom-select", @id = "jobId" })
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <label for="status" class="form-label font-weight-bold text-dark">
                                <i class="icon-flag mr-1 text-success"></i>Trạng thái
                            </label>
                            @Html.DropDownList("status", ViewBag.StatusOptions as SelectList, new { @class = "form-control form-control-lg custom-select", @id = "status" })
                        </div>
                        <div class="col-lg-4 col-md-12 mb-3">
                            <div class="d-flex flex-wrap gap-2">
                                <button type="submit" class="btn btn-primary btn-lg px-4 flex-grow-1 filter-btn">
                                    <i class="icon-search mr-2"></i>Tìm kiếm
                                </button>
                                <a href="@Url.Action("MyApplications", "RecruitersApplication")" class="btn btn-outline-secondary btn-lg px-4 reset-btn">
                                    <i class="icon-refresh mr-2"></i>Đặt lại
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Applications List -->
        @if (Model != null && Model.Any())
        {
            <div class="applications-container">
                @foreach (var app in Model)
                {
                    <div class="application-item mb-4">
                        <div class="card application-card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="row align-items-center">
                                    <!-- Candidate Info -->
                                    <div class="col-lg-6 col-md-12 mb-3 mb-lg-0">
                                        <div class="candidate-info">
                                            <h5 class="candidate-name mb-2">
                                                <a href="@Url.Action("ApplicationDetails", "RecruitersApplication", new { id = app.ApplicationID })" class="text-decoration-none">
                                                    <i class="icon-user mr-2 text-primary"></i>@app.CandidateName
                                                </a>
                                            </h5>
                                            <div class="job-info mb-3">
                                                <h6 class="job-title mb-1">
                                                    <a href="@Url.Action("Details", "JobDetails", new { id = app.JobPostID })" class="text-info text-decoration-none">
                                                        <i class="icon-briefcase mr-1"></i>@app.JobTitle
                                                    </a>
                                                    @if (!string.IsNullOrEmpty(app.JobCode))
                                                    {
                                                        <span class="badge badge-light badge-sm ml-2">@app.JobCode</span>
                                                    }
                                                </h6>
                                                <p class="company-name text-muted mb-0">
                                                    <i class="icon-building mr-1"></i>@app.CompanyName
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Contact & Date Info -->
                                    <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                                        <div class="contact-info">
                                            @if (!string.IsNullOrEmpty(app.CandidateEmail))
                                            {
                                                <p class="mb-1 small">
                                                    <i class="icon-envelope mr-1 text-muted"></i>
                                                    <a href="mailto:@app.CandidateEmail" class="text-decoration-none">@app.CandidateEmail</a>
                                                </p>
                                            }
                                            @if (!string.IsNullOrEmpty(app.CandidatePhone))
                                            {
                                                <p class="mb-1 small">
                                                    <i class="icon-phone mr-1 text-muted"></i>
                                                    <a href="tel:@app.CandidatePhone" class="text-decoration-none">@app.CandidatePhone</a>
                                                </p>
                                            }
                                            <p class="mb-1 small text-muted">
                                                <i class="icon-calendar mr-1"></i>
                                                Ứng tuyển: @(app.AppliedAt?.ToString("dd/MM/yyyy") ?? "N/A")
                                            </p>
                                            @if (app.UpdatedAt.HasValue)
                                            {
                                                <p class="mb-0 small text-muted">
                                                    <i class="icon-clock-o mr-1"></i>
                                                    Cập nhật: @app.UpdatedAt.Value.ToString("dd/MM/yyyy")
                                                </p>
                                            }
                                        </div>
                                    </div>
                                    
                                    <!-- Status & Actions -->
                                    <div class="col-lg-3 col-md-6">
                                        <div class="status-actions text-lg-right">
                                            <div class="status-badge mb-3">
                                                <span class="badge @app.StatusBadgeClass badge-lg px-3 py-2">@app.StatusDisplay</span>
                                            </div>
                                            <div class="action-buttons">
                                                <div class="btn-group-vertical btn-group-sm w-100" role="group">
                                                    <a href="@Url.Action("ApplicationDetails", "RecruitersApplication", new { id = app.ApplicationID })" 
                                                       class="btn btn-outline-primary mb-2">
                                                        <i class="icon-eye mr-1"></i>Xem chi tiết
                                                    </a>
                                                    <a href="@Url.Action("UpdateApplicationStatus", "RecruitersApplication", new { id = app.ApplicationID })" 
                                                       class="btn btn-primary update-status-btn" 
                                                       data-status="@app.Status">
                                                        <i class="icon-edit mr-1"></i>Cập nhật trạng thái
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            if (ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
            {
                <div class="row pagination-wrap">
                    <div class="col-md-6 text-center text-md-left mb-4 mb-md-0">
                        @{
                            int startItem = ((ViewBag.CurrentPage - 1) * 10) + 1;
                            int endItem = Math.Min(ViewBag.CurrentPage * 10, ViewBag.TotalItems);
                        }
                        <span>Hiển thị @startItem-@endItem trong @ViewBag.TotalItems đơn ứng tuyển</span>
                    </div>
                    <div class="col-md-6 text-center text-md-right">
                        <div class="custom-pagination ml-auto">
                            @if (ViewBag.CurrentPage > 1)
                            {
                                <a href="@Url.Action("MyApplications", "RecruitersApplication", new { jobId = ViewBag.JobId, status = ViewBag.Status, page = ViewBag.CurrentPage - 1 })" class="prev">Trước</a>
                            }
                            <div class="d-inline-block">
                                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                {
                                    if (i == ViewBag.CurrentPage)
                                    {
                                        <a href="#" class="active">@i</a>
                                    }
                                    else
                                    {
                                        <a href="@Url.Action("MyApplications", "RecruitersApplication", new { jobId = ViewBag.JobId, status = ViewBag.Status, page = i })">@i</a>
                                    }
                                }
                            </div>
                            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                            {
                                <a href="@Url.Action("MyApplications", "RecruitersApplication", new { jobId = ViewBag.JobId, status = ViewBag.Status, page = ViewBag.CurrentPage + 1 })" class="next">Sau</a>
                            }
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center py-5">
                <h3 class="mb-3">Chưa có đơn ứng tuyển nào</h3>
                <p class="lead mb-4">Hiện tại chưa có ứng viên nào ứng tuyển vào các công việc của bạn.</p>
                <a href="@Url.Action("MyJobs", "Jobs")" class="btn btn-primary btn-lg">
                    <i class="icon-briefcase mr-2"></i>Xem tin tuyển dụng của tôi
                </a>
            </div>
        }
    </div>
</section>

@section Styles {
    <link href="@Url.Content("~/Content/css/recruiters-application.css")?v=@DateTime.Now.Ticks" rel="stylesheet" type="text/css" />
}


