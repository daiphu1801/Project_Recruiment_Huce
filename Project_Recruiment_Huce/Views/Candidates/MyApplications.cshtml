@model IEnumerable<Project_Recruiment_Huce.Models.Candidates.ApplicationListItemViewModel>
@{
    ViewBag.Title = "Đơn ứng tuyển của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="@Url.Content("~/Content/css/recruiters-application.css")?v=@DateTime.Now.Ticks" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/css/candidates-applications.css")?v=@DateTime.Now.Ticks" rel="stylesheet" type="text/css" />
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">
          <i class="icon-file-text mr-3"></i>Đơn ứng tuyển của tôi
        </h1>
        <div class="custom-breadcrumbs">
          <a href="@Url.Action("Index","Home")" class="breadcrumb-link">
            <i class="icon-home mr-1"></i>Trang chủ
          </a> 
          <span class="mx-2 slash">/</span>
          <a href="@Url.Action("CandidatesManage","Candidates")" class="breadcrumb-link">
            <i class="icon-user mr-1"></i>Hồ sơ của tôi
          </a> 
          <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Đơn ứng tuyển</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="site-section">
  <div class="container">

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="icon-exclamation-triangle mr-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="icon-check-circle mr-2"></i>@TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (ViewBag.TotalItems != null)
    {
        <div class="stats-banner">
            <span>Tổng cộng: <strong>@ViewBag.TotalItems</strong> đơn ứng tuyển</span>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="applications-grid">
            @foreach (var app in Model)
            {
                <div class="application-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h5 class="job-title-simple">
                                <a href="@Url.Action("JobsDetails", "Jobs", new { id = app.JobPostID })">@app.JobTitle</a>
                            </h5>
                            <p class="company-simple mb-1">
                                <i class="icon-building mr-1"></i>@app.CompanyName
                            </p>
                            @if (!string.IsNullOrEmpty(app.Location))
                            {
                                <p class="location-simple mb-0">
                                    <i class="icon-map-marker mr-1"></i>@app.Location
                                </p>
                            }
                        </div>
                        <div class="col-md-3 text-center">
                            @{
                                string statusClass = "badge-warning";
                                string statusDisplay = "Đang xem xét";
                                if (!string.IsNullOrEmpty(app.Status))
                                {
                                    string statusLower = app.Status.ToLower();
                                    if (statusLower == "under review" || statusLower == "pending")
                                    {
                                        statusDisplay = "Đang xem xét";
                                        statusClass = "badge-warning";
                                    }
                                    else if (statusLower == "accepted" || statusLower == "approved")
                                    {
                                        statusDisplay = "Đã chấp nhận";
                                        statusClass = "badge-success";
                                    }
                                    else if (statusLower == "rejected" || statusLower == "declined")
                                    {
                                        statusDisplay = "Đã từ chối";
                                        statusClass = "badge-danger";
                                    }
                                    else if (statusLower == "interview" || statusLower == "interview scheduled")
                                    {
                                        statusDisplay = "Lịch phỏng vấn";
                                        statusClass = "badge-info";
                                    }
                                    else
                                    {
                                        statusDisplay = app.Status;
                                    }
                                }
                            }
                            <span class="badge @statusClass" style="font-size: 0.85rem; padding: 8px 15px;">@statusDisplay</span>
                            <p class="text-muted mt-2 mb-0" style="font-size: 0.8rem;">
                                Ứng tuyển: @(app.AppliedAt?.ToString("dd/MM/yyyy") ?? "N/A")
                            </p>
                        </div>
                        <div class="col-md-3 text-right">
                            <a href="@Url.Action("ApplicationDetails", "Candidates", new { id = app.ApplicationID })" class="btn btn-primary btn-sm">
                                <i class="icon-eye mr-1"></i>Chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    
    <!-- Pagination -->
    @if (Model != null && Model.Any() && ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
    {
        <div class="pagination-wrapper">
            <div class="pagination-custom">
                @if (ViewBag.CurrentPage > 1)
                {
                    <a href="@Url.Action("MyApplications", new { page = ViewBag.CurrentPage - 1 })">
                        <i class="icon-angle-left"></i> Trước
                    </a>
                }
                
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    if (i == ViewBag.CurrentPage)
                    {
                        <span class="active">@i</span>
                    }
                    else
                    {
                        <a href="@Url.Action("MyApplications", new { page = i })">@i</a>
                    }
                }
                
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <a href="@Url.Action("MyApplications", new { page = ViewBag.CurrentPage + 1 })">
                        Sau <i class="icon-angle-right"></i>
                    </a>
                }
            </div>
        </div>
    }
    
    @if (Model == null || !Model.Any())
    {
        <div class="empty-state">
            <i class="icon-file-text"></i>
            <h3>Chưa có đơn ứng tuyển nào</h3>
            <p>Bạn chưa ứng tuyển công việc nào. Hãy bắt đầu tìm kiếm các vị trí tuyển dụng phù hợp!</p>
            <a href="@Url.Action("JobsListing", "Jobs")" class="btn btn-primary btn-lg">
                <i class="icon-search mr-2"></i>Tìm việc làm ngay
            </a>
        </div>
    }
  </div>
</section>