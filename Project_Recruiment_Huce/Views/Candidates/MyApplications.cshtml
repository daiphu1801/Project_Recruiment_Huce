@model IEnumerable<Project_Recruiment_Huce.Models.Candidates.ApplicationListItemViewModel>
@{
    ViewBag.Title = "Đơn ứng tuyển của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        .application-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: box-shadow 0.3s ease;
            background: #fff;
        }
        .application-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .application-card.recent {
            border-left: 4px solid #28a745;
        }
        .application-card.expired {
            opacity: 0.7;
            border-left: 4px solid #dc3545;
        }
        .job-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .job-title a {
            color: #007bff;
            text-decoration: none;
        }
        .job-title a:hover {
            text-decoration: underline;
        }
        .company-name {
            color: #666;
            font-size: 1rem;
            margin-bottom: 12px;
        }
        .job-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #555;
        }
        .job-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .job-meta-item i {
            color: #999;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .status-under-review {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-accepted {
            background-color: #d4edda;
            color: #155724;
        }
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status-interview {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .application-date {
            color: #999;
            font-size: 0.85rem;
            margin-top: 12px;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }
        .pagination a {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #007bff;
        }
        .pagination a:hover {
            background-color: #f5f5f5;
        }
        .pagination .active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        .section-header {
            margin-bottom: 30px;
        }
        .section-header h2 {
            margin-bottom: 10px;
        }
        .stats-info {
            color: #666;
            font-size: 0.9rem;
        }
    </style>
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">Đơn ứng tuyển của tôi</h1>
        <div class="custom-breadcrumbs">
          <a href="@Url.Action("Index","Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
          <a href="@Url.Action("CandidatesManage","Candidates")">Hồ sơ của tôi</a> <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Đơn ứng tuyển</strong></span>
        </div>
        @if (ViewBag.TotalItems != null)
        {
          <div class="mt-3">
            <span class="text-white" style="font-size: 1rem; opacity: 0.9;">
              <i class="fas fa-file-alt mr-2"></i>Tổng cộng: @ViewBag.TotalItems đơn ứng tuyển
              @if (ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
              {
                <span class="ml-3">
                  <i class="fas fa-layer-group mr-2"></i>Trang @ViewBag.CurrentPage / @ViewBag.TotalPages
                </span>
              }
            </span>
          </div>
        }
      </div>
    </div>
  </div>
</section>

<section class="site-section">
  <div class="container">

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-warning" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }

    @if (Model != null && Model.Any())
    {
        foreach (var app in Model)
        {
            <div class="application-card @(app.IsRecent ? "recent" : "") @(app.IsExpired ? "expired" : "")">
                <div class="job-title">
                    <a href="@Url.Action("JobsDetails", "Jobs", new { id = app.JobPostID })">@app.JobTitle</a>
                </div>
                <div class="company-name">@app.CompanyName</div>
                
                <div class="job-meta">
                    @if (!string.IsNullOrEmpty(app.Location))
                    {
                        <div class="job-meta-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>@app.Location</span>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(app.SalaryRange))
                    {
                        <div class="job-meta-item">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>@app.SalaryRange</span>
                        </div>
                    }
                    @if (app.ApplicationDeadline.HasValue)
                    {
                        <div class="job-meta-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Hạn nộp: @app.ApplicationDeadline.Value.ToString("dd/MM/yyyy")</span>
                            @if (app.IsExpired)
                            {
                                <span class="badge badge-danger" style="margin-left: 5px;">Đã hết hạn</span>
                            }
                        </div>
                    }
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                    <div>
                        @{
                            string statusClass = "under-review";
                            string statusDisplay = "Đang xem xét";
                            if (!string.IsNullOrEmpty(app.Status))
                            {
                                string statusLower = app.Status.ToLower();
                                statusClass = statusLower.Replace(" ", "-");
                                if (statusLower == "under review" || statusLower == "pending")
                                {
                                    statusDisplay = "Đang xem xét";
                                }
                                else if (statusLower == "accepted" || statusLower == "approved")
                                {
                                    statusDisplay = "Đã chấp nhận";
                                }
                                else if (statusLower == "rejected" || statusLower == "declined")
                                {
                                    statusDisplay = "Đã từ chối";
                                }
                                else if (statusLower == "interview" || statusLower == "interview scheduled")
                                {
                                    statusDisplay = "Đã lên lịch phỏng vấn";
                                }
                                else
                                {
                                    statusDisplay = app.Status;
                                }
                            }
                        }
                        <span class="status-badge status-@statusClass">
                            @statusDisplay
                        </span>
                    </div>
                    <div class="application-date">
                        Ngày nộp đơn: @(app.AppliedAt?.ToString("dd/MM/yyyy HH:mm") ?? "N/A")
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(app.Note))
                {
                    <div style="margin-top: 12px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; font-size: 0.9rem; color: #666;">
                        <strong>Ghi chú:</strong> @app.Note
                    </div>
                }

                @if (!string.IsNullOrEmpty(app.ResumeFilePath) || !string.IsNullOrEmpty(app.CertificateFilePath))
                {
                    <div style="margin-top: 12px; font-size: 0.85rem;">
                        @if (!string.IsNullOrEmpty(app.ResumeFilePath))
                        {
                            <a href="@Url.Content(app.ResumeFilePath)" target="_blank" style="margin-right: 15px; color: #007bff;">
                                <i class="fas fa-file-pdf"></i> Xem CV
                            </a>
                        }
                    </div>
                }
            </div>
        }
    }
    
    <!-- Pagination -->
    @if (Model != null && Model.Any() && ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
    {
        <div class="pagination">
            @if (ViewBag.CurrentPage > 1)
            {
                <a href="@Url.Action("MyApplications", new { page = ViewBag.CurrentPage - 1 })">« Trước</a>
            }
            
            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <span class="active">@i</span>
                }
                else
                {
                    <a href="@Url.Action("MyApplications", new { page = i })">@i</a>
                }
            }
            
            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
            {
                <a href="@Url.Action("MyApplications", new { page = ViewBag.CurrentPage + 1 })">Sau »</a>
            }
        </div>
    }
    
    @if (Model == null || !Model.Any())
    {
        <div class="empty-state">
            <i class="fas fa-file-alt"></i>
            <h3>Chưa có đơn ứng tuyển nào</h3>
            <p>Bạn chưa ứng tuyển công việc nào. Hãy bắt đầu tìm kiếm các vị trí tuyển dụng!</p>
            <a href="@Url.Action("JobsListing", "Jobs")" class="btn btn-primary" style="margin-top: 20px;">Xem việc làm</a>
        </div>
    }
  </div>
</section>

