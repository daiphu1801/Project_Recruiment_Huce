@model Project_Recruiment_Huce.Models.Recruiter
@{
  ViewBag.Title = "Hồ sơ nhà tuyển dụng";
  Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">Hồ sơ nhà tuyển dụng</h1>
        <div class="custom-breadcrumbs">
          <a href="@Url.Action("Index","Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Nhà tuyển dụng</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="site-section">
  <div class="container">
    <div class="row mb-5">
      <div class="col-lg-12">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["ErrorMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        @using (Html.BeginForm("RecruitersManage", "Recruiters", FormMethod.Post, new { @class = "p-4 p-md-5 border rounded", id = "recruiter-form", enctype = "multipart/form-data" }))
        {
          @Html.AntiForgeryToken()
          @Html.ValidationSummary(true, "", new { @class = "text-danger mb-3" })
          @Html.HiddenFor(m => m.RecruiterID)
          @Html.HiddenFor(m => m.AccountID)
          @Html.HiddenFor(m => m.CompanyID)
          @Html.HiddenFor(m => m.CreatedAt)
          @Html.HiddenFor(m => m.ActiveFlag)

          <h3 class="text-black mb-5 border-bottom pb-2">Thông tin nhà tuyển dụng</h3>

          <!-- Avatar Upload Section -->
          <div class="form-row align-items-center mb-4">
            <div class="col-md-2 text-center mb-3 mb-md-0">
              @{ 
                string avatarUrl = null; 
                try {
                  var idClaim = (User != null && User.Identity != null) ? ((System.Security.Claims.ClaimsIdentity)User.Identity).FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier) : null;
                  if (idClaim != null) {
                    var accId = int.Parse(idClaim.Value);
                    using (var vdb = new Project_Recruiment_Huce.Models.JOBPORTAL_ENDataContext(System.Configuration.ConfigurationManager.ConnectionStrings["JOBPORTAL_ENConnectionString"].ConnectionString)) {
                      vdb.ObjectTrackingEnabled = false;
                      var acc = vdb.Accounts.FirstOrDefault(a => a.AccountID == accId);
                      if (acc != null && acc.PhotoID.HasValue) {
                        var photo = vdb.ProfilePhotos.FirstOrDefault(p => p.PhotoID == acc.PhotoID.Value);
                        if (photo != null) { avatarUrl = Url.Content(photo.FilePath); }
                      }
                    }
                  }
                } catch { }
              }
              <img id="avatarPreview" src="@(avatarUrl ?? Url.Content("~/Content/images/person_1.jpg"))" alt="avatar" style="width:80px;height:80px;border-radius:50%;object-fit:cover;" />
            </div>
            <div class="col-md-10">
              <label class="d-block">Tải ảnh đại diện</label>
              <label class="btn btn-success btn-md btn-file mb-0">
                Chọn file<input id="avatarInput" type="file" name="avatar" accept="image/*" hidden>
              </label>
              <small id="avatarFileName" class="text-muted ml-2"></small>
              <small class="text-muted ml-2">JPG/PNG tối đa 5MB.</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="FullName">Họ và tên</label>
              @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", placeholder = "Ví dụ: Nguyễn Văn A" })
              @Html.ValidationMessageFor(m => m.FullName, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-md-6">
              <label for="PositionTitle">Chức vụ</label>
              @Html.TextBoxFor(m => m.PositionTitle, new { @class = "form-control", placeholder = "Trưởng phòng nhân sự" })
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="CompanyEmail">Email công việc</label>
              @Html.TextBoxFor(m => m.CompanyEmail, new { @class = "form-control", type = "email", placeholder = "you@company.com" })
              @Html.ValidationMessageFor(m => m.CompanyEmail, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-md-6">
              <label for="Phone">Số điện thoại</label>
              @Html.TextBoxFor(m => m.Phone, new { @class = "form-control", placeholder = "090..." })
              @Html.ValidationMessageFor(m => m.Phone, "", new { @class = "text-danger" })
            </div>
          </div>

          <div class="text-right">
            <button type="submit" class="btn btn-primary btn-md">Lưu hồ sơ</button>
          </div>
        }
      </div>
    </div>
  </div>
</section>

<script>
  // Avatar preview functionality (same as CandidatesManage)
  document.addEventListener('DOMContentLoaded', function() {
    var avatarInput = document.getElementById('avatarInput');
    var avatarPreview = document.getElementById('avatarPreview');
    var avatarFileName = document.getElementById('avatarFileName');
    
    if (avatarInput && avatarPreview) {
      avatarInput.addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (file) {
          // Update file name display
          if (avatarFileName) {
            avatarFileName.textContent = file.name;
          }
          
          // Preview image
          var reader = new FileReader();
          reader.onload = function(e) {
            avatarPreview.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>

