@model Project_Recruiment_Huce.Models.Accounts.ResetPasswordViewModel
@{
    ViewBag.Title = "Đặt lại mật khẩu";
}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('@Url.Content("~/Content/images/hero_1.jpg")');" id="home-section">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">Đặt lại mật khẩu</h1>
        <div class="custom-breadcrumbs">
          <a href="@Url.Action("Index", "Home")">Trang chủ</a> <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Đặt lại mật khẩu</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="site-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-6">
        <h2 class="mb-4">Nhập mã xác thực và mật khẩu mới</h2>
        
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        <p class="mb-4">Vui lòng nhập mã xác thực 6 ký tự đã được gửi đến email của bạn và mật khẩu mới.</p>

        @using (Html.BeginForm("ResetPassword", "Account", FormMethod.Post, new { role = "form", @class = "p-4 border rounded" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <div class="row form-group">
              <div class="col-md-12 mb-3 mb-md-0">
                @Html.LabelFor(m => m.Email, new { @class = "text-black" })
                @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "Email đăng nhập", type = "email", @readonly = "readonly" })
                @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
              </div>
            </div>

            <div class="row form-group">
              <div class="col-md-12 mb-3 mb-md-0">
                @Html.LabelFor(m => m.ResetCode, new { @class = "text-black" })
                @Html.TextBoxFor(m => m.ResetCode, new { @class = "form-control", placeholder = "Nhập mã 6 ký tự", maxlength = "6", style = "text-transform: uppercase; letter-spacing: 3px; font-size: 20px; text-align: center; font-weight: bold;" })
                @Html.ValidationMessageFor(m => m.ResetCode, "", new { @class = "text-danger" })
                <small class="form-text text-muted">Mã xác thực có hiệu lực trong 15 phút</small>
              </div>
            </div>

            <div class="row form-group">
              <div class="col-md-12 mb-3 mb-md-0">
                @Html.LabelFor(m => m.NewPassword, new { @class = "text-black" })
                @Html.PasswordFor(m => m.NewPassword, new { @class = "form-control", placeholder = "Mật khẩu mới (tối thiểu 6 ký tự)" })
                @Html.ValidationMessageFor(m => m.NewPassword, "", new { @class = "text-danger" })
                <small class="form-text text-muted">Mật khẩu phải có tối thiểu 6 ký tự, bao gồm chữ hoa, chữ thường và số</small>
              </div>
            </div>

            <div class="row form-group mb-4">
              <div class="col-md-12 mb-3 mb-md-0">
                @Html.LabelFor(m => m.ConfirmPassword, new { @class = "text-black" })
                @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control", placeholder = "Nhập lại mật khẩu mới" })
                @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "text-danger" })
              </div>
            </div>

            <div class="row form-group">
              <div class="col-md-12">
                <input type="submit" value="Đặt lại mật khẩu" class="btn px-4 btn-primary text-white" />
              </div>
            </div>

            <div class="row form-group">
              <div class="col-md-12">
                <p class="mb-0">
                  <a href="@Url.Action("ForgotPassword", "Account")" class="text-primary">Gửi lại mã xác thực</a> | 
                  <a href="@Url.Action("Login", "Account")" class="text-primary">Quay lại đăng nhập</a>
                </p>
              </div>
            </div>
        }
      </div>
    </div>
  </div>
</section>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function() {
            // Auto-uppercase và chỉ cho phép chữ và số
            $('#ResetCode').on('input', function() {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
        });
    </script>
}

